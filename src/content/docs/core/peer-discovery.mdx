---
title: "Peer Discovery"
description: "How Extended Web applications find and connect to peers"
---

## The Peer Discovery Problem

In traditional client-server applications, discovery is simple: everyone knows the server's address (example.com). Clients connect to that fixed location.

In peer-to-peer applications, there's no fixed location. Your device and your collaborator's device could be anywhere on the internet, behind different NATs, on different networks. How do you find each other?

## Out-of-Band Initial Exchange

Extended Web applications solve initial peer discovery through **out-of-band key exchange**. "Out-of-band" means using a different channel than the application itself.

### First-Time Setup

When you want to connect with someone for the first time, you exchange device keys through any convenient method:

**QR Codes** - Scan each other's QR codes in person or via video call

**Text Message** - Send the device key as a text string

**Email** - Share keys via encrypted email

**Manual Entry** - Copy and paste the key string

**Any trusted channel** - Whatever method you trust for initial key exchange

This is a one-time setup. Once you've exchanged device keys, Iroh handles all future connectivity automatically.

### What Gets Exchanged

The device key exchange includes:

- **Device ID** - Unique identifier for this specific device
- **Public key** - For encrypting communications
- **Connection hints** - IP addresses, relay servers, etc.

This information tells Iroh "here's where to find this peer on the network."

## Iroh Handles Reachability

Once device keys are exchanged, Iroh's networking layer takes over for all future connections.

### Automatic Peer Finding

When your application wants to connect to a peer:

1. **DHT Lookup** - Iroh queries its Distributed Hash Table to find where the peer is currently reachable
2. **Direct Connection Attempt** - Tries to establish a direct QUIC connection
3. **NAT Traversal** - Uses STUN/TURN-like techniques to punch through firewalls
4. **Relay Fallback** - If direct connection fails, routes through Iroh relay servers

All of this happens automatically. Your application just says "connect to peer X" and Iroh handles the complexity.

### Relay Servers

Iroh maintains relay servers that help peers connect when direct P2P isn't possible (due to symmetric NATs or restrictive firewalls).

Relays provide:
- **Connection brokering** - Help peers find each other
- **NAT traversal assistance** - Coordinate hole-punching attempts
- **Data relay** - Forward encrypted traffic when direct connection impossible

Important: Relay servers can't decrypt your content - they only see encrypted QUIC packets. They're facilitating connectivity, not processing data.

### Connection Persistence

Once connected, Iroh maintains the connection:

- **Automatic reconnection** - If the connection drops, Iroh reestablishes it
- **Mobile network transitions** - Handles switching between WiFi and cellular
- **IP address changes** - Your peer's location can change, Iroh adapts
- **Multi-path** - Can use multiple network paths simultaneously for reliability

You exchange device keys once. After that, Iroh ensures you can always reach each other.

## Personal Nodes as Discovery Helpers

Your personal node (Orange Pi 6 Plus or similar) enhances discovery:

### Always-On Reachability

Because your node is always online, it acts as a stable point for discovery:

- Peers can find your node even when your laptop is offline
- The node can buffer connections and messages
- Other devices you control can always find your node first, then each other

### Multiple Device Coordination

If you have multiple devices (laptop, phone, tablet), they all connect to your node:

- The node knows about all your devices
- Helps coordinate sync between your own devices
- Acts as a hub for your personal infrastructure

### Shared Nodes

Multiple people can share a single node:

- Each person has their own identity (PGP keys, Permit signing keys)
- Device keys point to the shared node
- Node stores encrypted data per person (can't decrypt what it doesn't have keys for)
- Splits infrastructure costs while maintaining individual sovereignty

## Discovery vs. Authorization

It's important to understand the separation:

**Discovery** (Device Keys + Iroh):
- How to find a peer on the network
- Where to establish a connection
- What IP addresses and ports to use
- Network-layer concern

**Authorization** (Permits):
- What a peer is allowed to do
- What content they can access
- What operations they can perform
- Application-layer concern

Just because you can connect to someone (discovery) doesn't mean you're authorized to access their content. Those are separate layers with separate key systems.

## Security Properties

### Out-of-Band Trust

By exchanging device keys out-of-band, you establish trust through a channel you already trust:
- In-person QR code scan (highest trust)
- Encrypted messaging with verified contact
- Video call where you verify identity
- Any method where you're confident you're talking to the right person

This prevents man-in-the-middle attacks - if someone intercepts the device key exchange, you'd notice because the connection wouldn't go to who you expected.

### No Central Directory

There's no centralized directory of who's online or where people are. Discovery happens through:
- Direct device key exchange (out-of-band)
- DHT queries (decentralized)
- Relay coordination (ephemeral, can't see content)

No one can surveil who you're connecting with by monitoring a central directory.

### Forward Secrecy

Device keys can be rotated without changing your identity:
- Generate new device key for a device
- Share new key with existing peers
- Old connections still work, new ones use new key
- Compromise of old key doesn't affect new sessions

## Future: Blockchain-Based Discovery

Currently, discovery requires out-of-band device key exchange for initial setup. In the future, blockchain integration will enable global discovery:

**On-chain identity** - Your DID and device keys recorded as ERC-5192/ERC-721 tokens

**Public discovery** - Find people without out-of-band exchange (if they opt in)

**Verified device rotation** - Publicly auditable history of device key changes

**Revocation** - Mark compromised keys as invalid on-chain

This maintains privacy (content stays local/encrypted) while enabling global reachability for those who want it.

## Practical Workflow

Here's how peer discovery works in practice:

### One-Time Setup

1. You and a collaborator exchange device keys (QR code, text, etc.)
2. Your Iroh instances store each other's keys
3. Initial QUIC connection established

### Ongoing Use

1. Your application says "sync with peer X"
2. Iroh looks up peer X in DHT
3. Establishes connection (direct or via relay)
4. Your application exchanges Permits for authorization
5. Content syncs over encrypted connection

### Later Sessions

1. You open your application days/weeks later
2. Iroh automatically reconnects to known peers
3. Sync resumes where it left off
4. No manual reconnection needed

The device key exchange is one-time. Everything else is automatic.

## Summary

Peer discovery in the Extended Web uses a hybrid approach:

**Out-of-band exchange** - Initial device key sharing through trusted channels

**Iroh automation** - Automatic discovery, NAT traversal, relay coordination

**Personal nodes** - Always-on infrastructure for enhanced reachability

**Separate from authorization** - Discovery (network layer) is distinct from permissions (application layer)

This provides both security (out-of-band trust establishment) and convenience (automatic reconnection) without depending on centralized discovery services.
